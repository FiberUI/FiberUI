{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "use-local-storage-state",
  "type": "registry:hook",
  "title": "useLocalStorageState",
  "description": "A hook that synchronizes state with localStorage.",
  "categories": [
    "storage"
  ],
  "files": [
    {
      "path": "storage/use-local-storage-state.ts",
      "type": "registry:hook",
      "content": "import { useState, useEffect, useCallback, useRef } from \"react\";\n\ntype SetValue<T> = T | ((prevValue: T) => T);\n\n/**\n * Return type for useLocalStorageState hook\n */\nexport type UseLocalStorageStateReturn<T> = [\n    T,\n    (value: SetValue<T>) => void,\n    boolean,\n];\n\n/**\n * A React hook that syncs state with localStorage.\n * - SSR safe: Returns initialValue during server-side rendering\n * - Type-safe: Accepts generic type parameter\n * - Handles JSON serialization/deserialization automatically\n *\n * @param key - The localStorage key to sync with\n * @param initialValue - The initial value to use if no stored value exists\n * @returns A tuple of [value, setValue, isLoading]\n */\nexport function useLocalStorageState<T>(\n    key: string,\n    initialValue: T,\n): UseLocalStorageStateReturn<T> {\n    const initialValueRef = useRef(initialValue);\n    const [isLoading, setIsLoading] = useState(true);\n    const [storedValue, setStoredValue] = useState<T>(initialValue);\n\n    // Hydrate from localStorage on mount\n    useEffect(() => {\n        try {\n            const item = localStorage.getItem(key);\n            if (item !== null) {\n                setStoredValue(JSON.parse(item) as T);\n            }\n        } catch (error) {\n            console.warn(`Error reading localStorage key \"${key}\":`, error);\n        } finally {\n            setIsLoading(false);\n        }\n    }, [key]);\n\n    // Update localStorage when value changes\n    const setValue = useCallback(\n        (value: SetValue<T>) => {\n            try {\n                setStoredValue((prev) => {\n                    const valueToStore =\n                        value instanceof Function ? value(prev) : value;\n\n                    if (typeof window !== \"undefined\") {\n                        localStorage.setItem(key, JSON.stringify(valueToStore));\n                    }\n\n                    return valueToStore;\n                });\n            } catch (error) {\n                console.warn(`Error setting localStorage key \"${key}\":`, error);\n            }\n        },\n        [key],\n    );\n\n    // Listen for changes from other tabs/windows\n    useEffect(() => {\n        const handleStorageChange = (event: StorageEvent) => {\n            if (event.key === key && event.newValue !== null) {\n                try {\n                    setStoredValue(JSON.parse(event.newValue) as T);\n                } catch (error) {\n                    console.warn(\n                        `Error parsing storage event for key \"${key}\":`,\n                        error,\n                    );\n                }\n            } else if (event.key === key && event.newValue === null) {\n                setStoredValue(initialValueRef.current);\n            }\n        };\n\n        window.addEventListener(\"storage\", handleStorageChange);\n        return () => window.removeEventListener(\"storage\", handleStorageChange);\n    }, [key]);\n\n    return [storedValue, setValue, isLoading];\n}\n\nexport default useLocalStorageState;\n"
    }
  ]
}