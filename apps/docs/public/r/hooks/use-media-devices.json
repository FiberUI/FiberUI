{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "use-media-devices",
  "type": "registry:hook",
  "title": "useMediaDevices",
  "description": "A powerful hook for enumerating and managing connected media devices.",
  "categories": [
    "device"
  ],
  "files": [
    {
      "path": "device/use-media-devices.ts",
      "type": "registry:hook",
      "content": "import { useState, useEffect, useCallback, useMemo } from \"react\";\n\n/**\n * Device kind types for filtering\n */\nexport type MediaDeviceKind = \"audioinput\" | \"audiooutput\" | \"videoinput\";\n\n/**\n * Options for the useMediaDevices hook\n */\nexport interface UseMediaDevicesOptions {\n    /** Filter to specific device kinds. Can be a single kind or array of kinds. */\n    kind?: MediaDeviceKind | MediaDeviceKind[];\n    /** Whether to automatically request permissions on mount (default: false) */\n    requestPermissionOnMount?: boolean;\n}\n\n/**\n * Return type for the useMediaDevices hook\n */\nexport interface UseMediaDevicesReturn {\n    /** Array of connected media devices */\n    devices: MediaDeviceInfo[];\n    /** Whether the device list is currently loading */\n    isLoading: boolean;\n    /** Error object if device enumeration failed */\n    error: Error | null;\n    /** Whether the MediaDevices API is supported */\n    isSupported: boolean;\n    /** Manually refresh the device list */\n    refetch: () => Promise<void>;\n    /** Request media permissions to get device labels */\n    requestPermission: (\n        constraints?: MediaStreamConstraints,\n    ) => Promise<boolean>;\n    /** Whether permission has been granted (devices have labels) */\n    hasPermission: boolean;\n}\n\n/**\n * A React hook that provides a list of connected media input and output devices\n * (cameras, microphones, speakers) using the MediaDevices API.\n *\n * @param options - Configuration options for the hook\n * @returns UseMediaDevicesReturn object with devices, states, and utility functions\n *\n * @example\n * ```tsx\n * // Basic usage - list all devices\n * const { devices, isLoading, isSupported } = useMediaDevices();\n *\n * // Filter to specific device types\n * const { devices: cameras } = useMediaDevices({ kind: 'videoinput' });\n *\n * // Request permissions to get device labels\n * const { devices, requestPermission, hasPermission } = useMediaDevices();\n * await requestPermission({ audio: true });\n * ```\n */\nexport function useMediaDevices(\n    options: UseMediaDevicesOptions = {},\n): UseMediaDevicesReturn {\n    const { kind, requestPermissionOnMount = false } = options;\n\n    const [allDevices, setAllDevices] = useState<MediaDeviceInfo[]>([]);\n    const [isLoading, setIsLoading] = useState(true);\n    const [error, setError] = useState<Error | null>(null);\n    const [hasPermission, setHasPermission] = useState(false);\n\n    // Check if API is supported\n    const isSupported =\n        typeof navigator !== \"undefined\" && !!navigator.mediaDevices;\n\n    // Normalize kind filter to array\n    const kindFilter = useMemo(() => {\n        if (!kind) return null;\n        return Array.isArray(kind) ? kind : [kind];\n    }, [kind]);\n\n    // Filter devices based on kind option\n    const devices = useMemo(() => {\n        if (!kindFilter) return allDevices;\n        return allDevices.filter((device) =>\n            kindFilter.includes(device.kind as MediaDeviceKind),\n        );\n    }, [allDevices, kindFilter]);\n\n    // Fetch devices from the API\n    const fetchDevices = useCallback(async () => {\n        if (!isSupported) {\n            setIsLoading(false);\n            return;\n        }\n\n        try {\n            setError(null);\n            const deviceInfos = await navigator.mediaDevices.enumerateDevices();\n            setAllDevices(deviceInfos);\n\n            // Check if we have permission (devices have labels)\n            const hasLabels = deviceInfos.some(\n                (d) => d.label && d.label.length > 0,\n            );\n            setHasPermission(hasLabels);\n        } catch (err) {\n            setError(\n                err instanceof Error\n                    ? err\n                    : new Error(\"Failed to enumerate devices\"),\n            );\n        } finally {\n            setIsLoading(false);\n        }\n    }, [isSupported]);\n\n    // Refetch function exposed to consumers\n    const refetch = useCallback(async () => {\n        setIsLoading(true);\n        await fetchDevices();\n    }, [fetchDevices]);\n\n    // Request permission to access media devices\n    const requestPermission = useCallback(\n        async (\n            constraints: MediaStreamConstraints = { audio: true, video: true },\n        ): Promise<boolean> => {\n            if (!isSupported) return false;\n\n            try {\n                const stream =\n                    await navigator.mediaDevices.getUserMedia(constraints);\n                // Stop all tracks immediately - we just needed permission\n                stream.getTracks().forEach((track) => track.stop());\n\n                // Refetch devices to get labels\n                await fetchDevices();\n                return true;\n            } catch {\n                return false;\n            }\n        },\n        [isSupported, fetchDevices],\n    );\n\n    // Initial fetch and device change listener\n    useEffect(() => {\n        if (!isSupported) {\n            setIsLoading(false);\n            return;\n        }\n\n        let mounted = true;\n\n        const initFetch = async () => {\n            await fetchDevices();\n\n            // Auto-request permission if option is set\n            if (requestPermissionOnMount && mounted) {\n                await requestPermission();\n            }\n        };\n\n        initFetch();\n\n        // Listen for device changes\n        const handleDeviceChange = () => {\n            if (mounted) {\n                fetchDevices();\n            }\n        };\n\n        navigator.mediaDevices.addEventListener(\n            \"devicechange\",\n            handleDeviceChange,\n        );\n\n        return () => {\n            mounted = false;\n            navigator.mediaDevices.removeEventListener(\n                \"devicechange\",\n                handleDeviceChange,\n            );\n        };\n    }, [\n        isSupported,\n        fetchDevices,\n        requestPermissionOnMount,\n        requestPermission,\n    ]);\n\n    return {\n        devices,\n        isLoading,\n        error,\n        isSupported,\n        refetch,\n        requestPermission,\n        hasPermission,\n    };\n}\n\nexport default useMediaDevices;\n"
    }
  ]
}