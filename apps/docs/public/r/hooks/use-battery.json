{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "use-battery",
  "type": "registry:hook",
  "title": "useBattery",
  "description": "A React hook for monitoring device battery status.",
  "categories": [
    "device"
  ],
  "files": [
    {
      "path": "device/use-battery.ts",
      "type": "registry:hook",
      "content": "import { useState, useEffect, useCallback } from \"react\";\n\n/**\n * Battery Manager interface (experimental Web API)\n */\ninterface BatteryManager extends EventTarget {\n    charging: boolean;\n    chargingTime: number;\n    dischargingTime: number;\n    level: number;\n}\n\n/**\n * Battery event names\n */\nconst BATTERY_EVENTS = {\n    LEVEL_CHANGE: \"levelchange\",\n    CHARGING_CHANGE: \"chargingchange\",\n    CHARGING_TIME_CHANGE: \"chargingtimechange\",\n    DISCHARGING_TIME_CHANGE: \"dischargingtimechange\",\n} as const;\n\n/**\n * Battery state returned by the hook\n */\nexport interface BatteryState {\n    /** Whether the Battery API is supported in this browser */\n    isSupported: boolean;\n    /** Whether the battery data is still loading */\n    isLoading: boolean;\n    /** Battery level from 0 to 1 (e.g., 0.75 = 75%) */\n    level: number | null;\n    /** Battery level as a percentage (0-100) */\n    levelPercent: number | null;\n    /** Whether the device is currently charging */\n    isCharging: boolean | null;\n    /** Time in seconds until fully charged (Infinity if not charging) */\n    chargingTime: number | null;\n    /** Time in seconds until fully discharged (Infinity if charging) */\n    dischargingTime: number | null;\n    /** Formatted time until full charge (e.g., \"1h 30m\") */\n    chargingTimeFormatted: string | null;\n    /** Formatted time until discharge (e.g., \"2h 45m\") */\n    dischargingTimeFormatted: string | null;\n    /** Battery status: 'charging', 'discharging', 'full', or 'unknown' */\n    status: \"charging\" | \"discharging\" | \"full\" | \"unknown\";\n    /** Whether battery is low (below 20%) */\n    isLow: boolean;\n    /** Whether battery is critical (below 10%) */\n    isCritical: boolean;\n}\n\n/**\n * Formats seconds into a human-readable string (e.g., \"1h 30m\")\n */\nfunction formatTime(seconds: number | null): string | null {\n    if (seconds === null || seconds === Infinity || isNaN(seconds)) {\n        return null;\n    }\n\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n\n    if (hours > 0) {\n        return `${hours}h ${minutes}m`;\n    }\n    return `${minutes}m`;\n}\n\n/**\n * Determines battery status based on charging state and level\n */\nfunction getBatteryStatus(\n    charging: boolean | null,\n    level: number | null,\n): BatteryState[\"status\"] {\n    if (charging === null || level === null) return \"unknown\";\n    if (charging && level >= 1) return \"full\";\n    if (charging) return \"charging\";\n    return \"discharging\";\n}\n\nconst initialState: BatteryState = {\n    isSupported: true,\n    isLoading: true,\n    level: null,\n    levelPercent: null,\n    isCharging: null,\n    chargingTime: null,\n    dischargingTime: null,\n    chargingTimeFormatted: null,\n    dischargingTimeFormatted: null,\n    status: \"unknown\",\n    isLow: false,\n    isCritical: false,\n};\n\n/**\n * Adds all battery event listeners\n */\nfunction addBatteryListeners(\n    battery: BatteryManager,\n    handler: EventListener,\n): void {\n    Object.values(BATTERY_EVENTS).forEach((event) => {\n        battery.addEventListener(event, handler);\n    });\n}\n\n/**\n * Removes all battery event listeners\n */\nfunction removeBatteryListeners(\n    battery: BatteryManager,\n    handler: EventListener,\n): void {\n    Object.values(BATTERY_EVENTS).forEach((event) => {\n        battery.removeEventListener(event, handler);\n    });\n}\n\n/**\n * A React hook that provides real-time battery information.\n *\n * @returns BatteryState object with battery level, charging status, and more\n *\n * @example\n * ```tsx\n * const battery = useBattery();\n *\n * if (!battery.isSupported) {\n *     return <p>Battery API not supported</p>;\n * }\n *\n * return (\n *     <div>\n *         <p>Battery: {battery.levelPercent}%</p>\n *         <p>Status: {battery.status}</p>\n *     </div>\n * );\n * ```\n */\nexport function useBattery(): BatteryState {\n    const [state, setState] = useState<BatteryState>(initialState);\n\n    const updateBatteryState = useCallback((battery: BatteryManager) => {\n        const level = battery.level;\n        const charging = battery.charging;\n\n        setState({\n            isSupported: true,\n            isLoading: false,\n            level,\n            levelPercent: Math.round(level * 100),\n            isCharging: charging,\n            chargingTime: battery.chargingTime,\n            dischargingTime: battery.dischargingTime,\n            chargingTimeFormatted: formatTime(battery.chargingTime),\n            dischargingTimeFormatted: formatTime(battery.dischargingTime),\n            status: getBatteryStatus(charging, level),\n            isLow: level < 0.2,\n            isCritical: level < 0.1,\n        });\n    }, []);\n\n    useEffect(() => {\n        // Check if running on server or if API is not supported\n        if (typeof window === \"undefined\" || !(\"getBattery\" in navigator)) {\n            setState((s) => ({\n                ...s,\n                isSupported: false,\n                isLoading: false,\n            }));\n            return;\n        }\n\n        let battery: BatteryManager | null = null;\n        let mounted = true;\n\n        const handleChange = () => {\n            if (battery && mounted) {\n                updateBatteryState(battery);\n            }\n        };\n\n        // Fetch the battery manager using async/await\n        (async () => {\n            try {\n                const bat: BatteryManager = await (\n                    navigator as any\n                ).getBattery();\n\n                if (!mounted) return;\n\n                battery = bat;\n                handleChange();\n\n                // Listen for changes\n                addBatteryListeners(bat, handleChange);\n            } catch {\n                if (mounted) {\n                    setState((s) => ({\n                        ...s,\n                        isSupported: false,\n                        isLoading: false,\n                    }));\n                }\n            }\n        })();\n\n        // Cleanup\n        return () => {\n            mounted = false;\n            if (battery) {\n                removeBatteryListeners(battery, handleChange);\n            }\n        };\n    }, [updateBatteryState]);\n\n    return state;\n}\n\nexport default useBattery;\n"
    }
  ]
}