{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "use-screen-share",
  "type": "registry:hook",
  "title": "useScreenShare",
  "description": "A simplified hook for capturing screen content.",
  "categories": [
    "webrtc"
  ],
  "files": [
    {
      "path": "webrtc/use-screen-share.ts",
      "type": "registry:hook",
      "content": "import { useState, useEffect, useCallback, useRef } from \"react\";\n\n/**\n * Options for getDisplayMedia\n */\nexport interface UseScreenShareOptions {\n    /** Whether to include audio (default: false) */\n    audio?: boolean | MediaTrackConstraints;\n    /** Video constraints for screen capture */\n    video?:\n        | boolean\n        | (MediaTrackConstraints & DisplayMediaStreamOptions[\"video\"]);\n    /** Whether to prefer current tab (Chrome only) */\n    preferCurrentTab?: boolean;\n    /** Surface types to allow: \"monitor\", \"window\", \"browser\" */\n    surfaceTypes?: (\"monitor\" | \"window\" | \"browser\")[];\n    /** Whether to show system audio option (default: false) */\n    systemAudio?: \"include\" | \"exclude\";\n    /** Auto-stop when user ends share via browser UI (default: true) */\n    autoStopOnEnd?: boolean;\n}\n\n/**\n * Return type for the useScreenShare hook\n */\nexport interface UseScreenShareReturn {\n    /** The screen share stream */\n    stream: MediaStream | null;\n    /** Whether screen share is active */\n    isSharing: boolean;\n    /** Whether share is being acquired */\n    isLoading: boolean;\n    /** Error if sharing failed */\n    error: Error | null;\n    /** Whether the API is supported */\n    isSupported: boolean;\n    /** Start screen sharing */\n    start: (options?: UseScreenShareOptions) => Promise<boolean>;\n    /** Stop screen sharing */\n    stop: () => void;\n    /** The video track from the share */\n    videoTrack: MediaStreamTrack | null;\n    /** The audio track from the share (if included) */\n    audioTrack: MediaStreamTrack | null;\n    /** Display surface type: \"monitor\", \"window\", or \"browser\" */\n    displaySurface: string | null;\n}\n\n/**\n * A React hook for screen/window sharing using getDisplayMedia.\n * Captures the user's screen, application window, or browser tab.\n *\n * @param defaultOptions - Default options for screen sharing\n * @returns UseScreenShareReturn object with stream, states, and controls\n *\n * @example\n * ```tsx\n * const { stream, isSharing, start, stop } = useScreenShare();\n *\n * // Start sharing\n * await start();\n *\n * // Display in video element\n * videoRef.current.srcObject = stream;\n *\n * // Stop when done\n * stop();\n * ```\n */\nexport function useScreenShare(\n    defaultOptions: UseScreenShareOptions = {},\n): UseScreenShareReturn {\n    const [stream, setStream] = useState<MediaStream | null>(null);\n    const [isLoading, setIsLoading] = useState(false);\n    const [error, setError] = useState<Error | null>(null);\n    const [displaySurface, setDisplaySurface] = useState<string | null>(null);\n    const optionsRef = useRef<UseScreenShareOptions>(defaultOptions);\n\n    // Check if API is supported\n    const isSupported =\n        typeof navigator !== \"undefined\" &&\n        !!navigator.mediaDevices?.getDisplayMedia;\n\n    // Get tracks\n    const videoTrack = stream?.getVideoTracks()[0] ?? null;\n    const audioTrack = stream?.getAudioTracks()[0] ?? null;\n\n    // Stop sharing\n    const stop = useCallback(() => {\n        if (stream) {\n            stream.getTracks().forEach((track) => track.stop());\n        }\n        setStream(null);\n        setDisplaySurface(null);\n        setError(null);\n    }, [stream]);\n\n    // Start sharing\n    const start = useCallback(\n        async (options?: UseScreenShareOptions): Promise<boolean> => {\n            if (!isSupported) {\n                setError(new Error(\"getDisplayMedia is not supported\"));\n                return false;\n            }\n\n            // Merge options\n            const mergedOptions = { ...optionsRef.current, ...options };\n            const { autoStopOnEnd = true, ...displayMediaOptions } =\n                mergedOptions;\n\n            setIsLoading(true);\n            setError(null);\n\n            try {\n                // Stop existing share first\n                if (stream) {\n                    stream.getTracks().forEach((track) => track.stop());\n                }\n\n                const displayStream =\n                    await navigator.mediaDevices.getDisplayMedia({\n                        audio: displayMediaOptions.audio ?? false,\n                        video: displayMediaOptions.video ?? true,\n                    } as DisplayMediaStreamOptions);\n\n                // Get display surface type from track settings\n                const videoTrack = displayStream.getVideoTracks()[0];\n                if (videoTrack) {\n                    const settings =\n                        videoTrack.getSettings() as MediaTrackSettings & {\n                            displaySurface?: string;\n                        };\n                    setDisplaySurface(settings.displaySurface ?? null);\n\n                    // Auto-stop when user ends share via browser UI\n                    if (autoStopOnEnd) {\n                        videoTrack.onended = () => {\n                            stop();\n                        };\n                    }\n                }\n\n                setStream(displayStream);\n                setIsLoading(false);\n                return true;\n            } catch (err) {\n                const error =\n                    err instanceof Error\n                        ? err\n                        : new Error(\"Failed to start screen share\");\n                setError(error);\n                setStream(null);\n                setDisplaySurface(null);\n                setIsLoading(false);\n                return false;\n            }\n        },\n        [isSupported, stream, stop],\n    );\n\n    // Cleanup on unmount\n    useEffect(() => {\n        return () => {\n            if (stream) {\n                stream.getTracks().forEach((track) => track.stop());\n            }\n        };\n    }, [stream]);\n\n    return {\n        stream,\n        isSharing: stream !== null,\n        isLoading,\n        error,\n        isSupported,\n        start,\n        stop,\n        videoTrack,\n        audioTrack,\n        displaySurface,\n    };\n}\n\nexport default useScreenShare;\n"
    }
  ]
}