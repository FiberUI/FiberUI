{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "use-file-system",
  "type": "registry:hook",
  "title": "useFileSystem",
  "description": "A hook for reading and writing files using the File System Access API.",
  "categories": [
    "storage"
  ],
  "files": [
    {
      "path": "storage/use-file-system.ts",
      "type": "registry:hook",
      "content": "import { useState, useCallback } from \"react\";\n\n/**\n * Options for file picking\n */\nexport interface OpenFileOptions {\n    /** Allowed MIME types or file extensions */\n    types?: FilePickerAcceptType[];\n    /** Allow multiple file selection */\n    multiple?: boolean;\n    /** excluded types */\n    excludeAcceptAllOption?: boolean;\n    /** Description for the file picker */\n    description?: string;\n}\n\n/**\n * Options for file saving\n */\nexport interface SaveFileOptions {\n    /** Suggested file name */\n    suggestedName?: string;\n    /** Allowed MIME types */\n    types?: FilePickerAcceptType[];\n}\n\n/**\n * Return type for the useFileSystem hook\n */\nexport interface UseFileSystemReturn {\n    /** Open a file picker and load the file */\n    openFile: (options?: OpenFileOptions) => Promise<File | null>;\n    /** Save content to the currently open file */\n    saveFile: (content: string | Blob | BufferSource) => Promise<boolean>;\n    /** Save content to a new file (Save As) */\n    saveFileAs: (\n        content: string | Blob | BufferSource,\n        options?: SaveFileOptions,\n    ) => Promise<boolean>;\n    /** The currently active file handle */\n    fileHandle: FileSystemFileHandle | null;\n    /** The currently loaded file object */\n    file: File | null;\n    /** Whether the API is supported */\n    isSupported: boolean;\n    /** Whether an operation is in progress */\n    isLoading: boolean;\n    /** Error from last operation */\n    error: Error | null;\n}\n\n// Types for File System Access API\n// These might be available in newer TypeScript versions or DOM libs,\n// but defining them here ensures compatibility.\ninterface FilePickerAcceptType {\n    description?: string;\n    accept: Record<string, string[]>;\n}\n\ninterface OpenFilePickerOptions {\n    multiple?: boolean;\n    excludeAcceptAllOption?: boolean;\n    types?: FilePickerAcceptType[];\n}\n\ninterface SaveFilePickerOptions {\n    suggestedName?: string;\n    types?: FilePickerAcceptType[];\n}\n\ndeclare global {\n    interface Window {\n        showOpenFilePicker?: (\n            options?: OpenFilePickerOptions,\n        ) => Promise<FileSystemFileHandle[]>;\n        showSaveFilePicker?: (\n            options?: SaveFilePickerOptions,\n        ) => Promise<FileSystemFileHandle>;\n    }\n}\n\n/**\n * A React hook that provides access to the File System Access API,\n * allowing reading and writing files directly to the user's system.\n *\n * @returns UseFileSystemReturn and state\n */\nexport function useFileSystem(): UseFileSystemReturn {\n    const [fileHandle, setFileHandle] = useState<FileSystemFileHandle | null>(\n        null,\n    );\n    const [file, setFile] = useState<File | null>(null);\n    const [isLoading, setIsLoading] = useState(false);\n    const [error, setError] = useState<Error | null>(null);\n\n    // Check support\n    const isSupported =\n        typeof window !== \"undefined\" && \"showOpenFilePicker\" in window;\n\n    // Open file\n    const openFile = useCallback(\n        async (options: OpenFileOptions = {}): Promise<File | null> => {\n            if (!isSupported) {\n                setError(new Error(\"File System Access API is not supported\"));\n                return null;\n            }\n\n            setIsLoading(true);\n            setError(null);\n\n            try {\n                // @ts-ignore - API support check handles this\n                const handles = await window.showOpenFilePicker({\n                    multiple: false, // We only support single file for this simple hook for now\n                    types: options.types,\n                    excludeAcceptAllOption: options.excludeAcceptAllOption,\n                });\n\n                if (!handles || handles.length === 0 || !handles[0]) {\n                    setIsLoading(false);\n                    return null;\n                }\n\n                const handle = handles[0];\n                const fileData = await handle.getFile();\n\n                setFileHandle(handle);\n                setFile(fileData);\n                return fileData;\n            } catch (err) {\n                // Ignore abort errors (user cancelled)\n                if ((err as Error).name !== \"AbortError\") {\n                    const error =\n                        err instanceof Error\n                            ? err\n                            : new Error(\"Failed to open file\");\n                    setError(error);\n                }\n                return null;\n            } finally {\n                setIsLoading(false);\n            }\n        },\n        [isSupported],\n    );\n\n    // Write content to a handle\n    const writeToHandle = async (\n        handle: FileSystemFileHandle,\n        content: string | Blob | BufferSource,\n    ) => {\n        // Create a writable stream\n        // @ts-ignore\n        const writable = await handle.createWritable();\n        // Write the contents\n        await writable.write(content);\n        // Close the file\n        await writable.close();\n    };\n\n    // Save to current file\n    const saveFile = useCallback(\n        async (content: string | Blob | BufferSource): Promise<boolean> => {\n            if (!isSupported) {\n                setError(new Error(\"File System Access API is not supported\"));\n                return false;\n            }\n\n            if (!fileHandle) {\n                setError(new Error(\"No file currently open\"));\n                return false;\n            }\n\n            setIsLoading(true);\n            setError(null);\n\n            try {\n                await writeToHandle(fileHandle, content);\n\n                // Refresh file data\n                const updatedFile = await fileHandle.getFile();\n                setFile(updatedFile);\n                return true;\n            } catch (err) {\n                const error =\n                    err instanceof Error\n                        ? err\n                        : new Error(\"Failed to save file\");\n                setError(error);\n                return false;\n            } finally {\n                setIsLoading(false);\n            }\n        },\n        [isSupported, fileHandle],\n    );\n\n    // Save as new file\n    const saveFileAs = useCallback(\n        async (\n            content: string | Blob | BufferSource,\n            options: SaveFileOptions = {},\n        ): Promise<boolean> => {\n            if (!isSupported) {\n                setError(new Error(\"File System Access API is not supported\"));\n                return false;\n            }\n\n            setIsLoading(true);\n            setError(null);\n\n            try {\n                // @ts-ignore\n                const handle = await window.showSaveFilePicker({\n                    suggestedName: options.suggestedName,\n                    types: options.types,\n                });\n\n                await writeToHandle(handle, content);\n\n                const fileData = await handle.getFile();\n                setFileHandle(handle);\n                setFile(fileData);\n                return true;\n            } catch (err) {\n                if ((err as Error).name !== \"AbortError\") {\n                    const error =\n                        err instanceof Error\n                            ? err\n                            : new Error(\"Failed to save file\");\n                    setError(error);\n                }\n                return false;\n            } finally {\n                setIsLoading(false);\n            }\n        },\n        [isSupported],\n    );\n\n    return {\n        openFile,\n        saveFile,\n        saveFileAs,\n        fileHandle,\n        file,\n        isSupported,\n        isLoading,\n        error,\n    };\n}\n\nexport default useFileSystem;\n"
    }
  ]
}